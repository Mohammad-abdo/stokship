// ============================================
// MEDIATION PLATFORM SCHEMA
// ============================================
// This schema represents the mediation/brokerage platform
// where the platform acts as a financial intermediary

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  ADMIN
  EMPLOYEE
  TRADER
  CLIENT
}

enum UserType {
  ADMIN
  EMPLOYEE
  TRADER
  CLIENT
  SYSTEM
}

enum OfferStatus {
  DRAFT
  PENDING_VALIDATION
  ACTIVE
  CLOSED
  REJECTED
}

enum DealStatus {
  NEGOTIATION
  APPROVED
  PAID
  SETTLED
  CANCELLED
  DISPUTED
}

enum NegotiationMessageType {
  TEXT
  PRICE_PROPOSAL
  QUANTITY_PROPOSAL
  TERMS_PROPOSAL
  SYSTEM_NOTIFICATION
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  HELD
}

enum PaymentMethod {
  BANK_TRANSFER
  BANK_CARD
  WALLET
}

enum TransactionType {
  DEPOSIT // Client pays platform
  COMMISSION // Platform commission
  EMPLOYEE_COMMISSION // Employee commission
  TRADER_PAYOUT // Trader receives payment
  REFUND // Refund to client
  ADJUSTMENT // Manual adjustment
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum InvoiceStatus {
  DRAFT
  PENDING
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum ContentPageType {
  SUPPORT_CENTER
  CONTACT_US
  TERMS_AND_CONDITIONS
  PRIVACY_POLICY
  ABOUT_COMPANY
  SUPPORT_TEXT
  FAQ
  HELP
  OTHER
}

enum AuditAction {
  DEAL_CREATED
  DEAL_UPDATED
  DEAL_APPROVED
  DEAL_PAID
  DEAL_SETTLED
  NEGOTIATION_MESSAGE
  PAYMENT_RECEIVED
  COMMISSION_CALCULATED
  EMPLOYEE_INTERVENTION
  DISPUTE_RAISED
}

// ============================================
// CORE USER ENTITIES
// ============================================

model Admin {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  password      String
  name          String
  phone         String?
  role          String    @default("admin")
  isActive      Boolean   @default(true)
  isSuperAdmin  Boolean   @default(false)
  lastLoginAt   DateTime?
  rememberToken String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  createdEmployees      Employee[]
  activityLogs          ActivityLog[]          @relation("ActivityLogAdmin")
  auditTrails           AuditTrail[]           @relation("AuditTrailAdmin")
  financialTransactions FinancialTransaction[] @relation("FinancialTransactionAdmin")
  createdContentPages   ContentPage[]          @relation("ContentPageCreator")
  updatedContentPages   ContentPage[]          @relation("ContentPageUpdater")
  platformSettingsUpdates PlatformSettings[]   @relation("PlatformSettingsUpdater")
}

model Employee {
  id             Int       @id @default(autoincrement())
  email          String    @unique
  password       String
  name           String
  phone          String?
  employeeCode   String    @unique // Auto-generated
  isActive       Boolean   @default(true)
  commissionRate Decimal   @default(1.0) @db.Decimal(5, 2) // Percentage
  createdBy      Int // Admin ID
  lastLoginAt    DateTime?
  rememberToken  String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  createdByAdmin        Admin                  @relation(fields: [createdBy], references: [id])
  traders               Trader[] // Traders linked to this employee
  deals                 Deal[] // Deals this employee guarantees
  activityLogs          ActivityLog[]          @relation("ActivityLogEmployee")
  auditTrails           AuditTrail[]           @relation("AuditTrailEmployee")
  financialTransactions FinancialTransaction[] @relation("FinancialTransactionEmployee")

  @@index([createdBy])
  @@index([employeeCode])
}

model Trader {
  id            Int       @id @default(autoincrement())
  email         String    @unique
  password      String
  name          String
  companyName   String
  phone         String?
  countryCode   String?
  country       String?
  city          String?
  traderCode    String    @unique // Auto-generated (e.g., TRD-001)
  barcode       String    @unique // Barcode/QR code
  qrCodeUrl     String? // QR code image URL
  employeeId    Int // Permanently linked to this employee
  clientId      Int?      @unique // Link to Client profile if same user (one-to-one)
  isActive      Boolean   @default(true)
  isVerified    Boolean   @default(false)
  verifiedAt    DateTime?
  lastLoginAt   DateTime?
  rememberToken String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  employee         Employee          @relation(fields: [employeeId], references: [id])
  client           Client?           @relation(fields: [clientId], references: [id], onDelete: SetNull)
  offers           Offer[]
  deals            Deal[]
  dealNegotiations DealNegotiation[] @relation("DealNegotiationTrader")
  activityLogs     ActivityLog[]     @relation("ActivityLogTrader")
  auditTrails      AuditTrail[]      @relation("AuditTrailTrader")

  @@index([employeeId])
  @@index([clientId])
  @@index([traderCode])
  @@index([barcode])
}

model Client {
  id              Int       @id @default(autoincrement())
  email           String    @unique
  password        String
  name            String
  phone           String?
  countryCode     String?
  country         String?
  city            String?
  isActive        Boolean   @default(true)
  isEmailVerified Boolean   @default(false)
  termsAccepted   Boolean   @default(false)
  termsAcceptedAt DateTime?
  language        String    @default("ar")
  lastLoginAt     DateTime?
  rememberToken   String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  trader           Trader?           @relation // One-to-one relation: Trader references Client via clientId
  deals            Deal[]
  dealNegotiations DealNegotiation[] @relation("DealNegotiationClient")
  payments         Payment[]
  activityLogs     ActivityLog[]     @relation("ActivityLogClient")
  auditTrails      AuditTrail[]      @relation("AuditTrailClient")
}

// ============================================
// OFFER MANAGEMENT
// ============================================

model Offer {
  id                 Int         @id @default(autoincrement())
  traderId           Int
  title              String
  description        String?     @db.Text
  status             OfferStatus @default(DRAFT)
  totalCartons       Int         @default(0)
  totalCBM           Decimal     @default(0) @db.Decimal(10, 3)
  // Ad/Offer metadata from create page
  category           String? // Category from create page (electronics, clothing, etc.) - Legacy field for backward compatibility
  categoryId         Int? // Category ID - New field for relation
  acceptsNegotiation Boolean     @default(false) // Whether trader accepts negotiation
  country            String? // Country from create page (Stockship Fees section)
  city               String? // City from create page (Stockship Fees section)
  images             String?     @db.Text // JSON array of main ad images (Upload Images section)
  // Excel file storage
  excelFileUrl       String? // Original Excel file URL/path
  excelFileName      String? // Original Excel file name
  excelFileSize      Int? // File size in bytes
  // Excel metadata
  companyName        String? // Company name from Excel header
  proformaInvoiceNo  String? // Proforma Invoice No from Excel header
  excelDate          DateTime? // DATE from Excel header
  validatedBy        Int? // Employee ID who validated
  validatedAt        DateTime?
  validationNotes    String?     @db.Text
  closedAt           DateTime?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  // Relations
  trader       Trader        @relation(fields: [traderId], references: [id])
  categoryRelation Category? @relation("OfferCategory", fields: [categoryId], references: [id])
  items        OfferItem[]
  deals        Deal[]
  activityLogs ActivityLog[] @relation("ActivityLogOffer")

  @@index([traderId])
  @@index([status])
  @@index([categoryId])
}

model OfferItem {
  id              Int      @id @default(autoincrement())
  offerId         Int
  // Excel-based fields
  itemNo          String? // Item number from Excel (ITEM NO.)
  productName     String // Descriptive name only (DESCRIPTION)
  description     String?  @db.Text
  colour          String? // Colour from Excel
  spec            String? // SPEC. from Excel
  quantity        Int // QUANTITY from Excel
  unit            String? // Unit from Excel (SET, PCS, etc.)
  unitPrice       Decimal? @db.Decimal(10, 2) // UNIT PRICE from Excel
  currency        String? // CURRENCY from Excel (USD, SR, etc.)
  amount          Decimal? @db.Decimal(10, 2) // AMOUNT from Excel
  packing         String? // PACKING from Excel
  packageQuantity Int? // PACKAGE QUANTITY (CTN) from Excel
  unitGW          Decimal? @db.Decimal(10, 2) // UNIT G.W. (KGS) from Excel
  totalGW         Decimal? @db.Decimal(10, 2) // TOTAL G.W. (KGS) from Excel
  // Carton dimensions
  cartonLength    Decimal? @db.Decimal(10, 2) // CARTON SIZE (CM) - Length
  cartonWidth     Decimal? @db.Decimal(10, 2) // CARTON SIZE (CM) - Width
  cartonHeight    Decimal? @db.Decimal(10, 2) // CARTON SIZE (CM) - Height
  totalCBM        Decimal  @db.Decimal(10, 4) // TOTAL CBM from Excel
  // Legacy fields (for backward compatibility)
  cartons         Int      @default(0) // Number of cartons
  length          Decimal? @db.Decimal(10, 2) // cm (alias for cartonLength)
  width           Decimal? @db.Decimal(10, 2) // cm (alias for cartonWidth)
  height          Decimal? @db.Decimal(10, 2) // cm (alias for cartonHeight)
  cbm             Decimal  @db.Decimal(10, 3) // Calculated: (L*W*H)/1,000,000 (alias for totalCBM)
  weight          Decimal? @db.Decimal(10, 2) // kg (alias for totalGW)
  country         String?
  city            String?
  images          String?  @db.Text // JSON array of image URLs (IMAGE from Excel)
  notes           String?  @db.Text
  displayOrder    Int      @default(0) // NO from Excel
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  offer     Offer      @relation(fields: [offerId], references: [id], onDelete: Cascade)
  dealItems DealItem[]

  @@index([offerId])
  @@index([itemNo])
}

// ============================================
// DEAL MANAGEMENT
// ============================================

model Deal {
  id                 Int        @id @default(autoincrement())
  dealNumber         String     @unique // Auto-generated (e.g., DEAL-2024-001)
  offerId            Int
  traderId           Int
  clientId           Int
  employeeId         Int // Guarantor employee
  status             DealStatus @default(NEGOTIATION)
  negotiatedAmount   Decimal?   @db.Decimal(10, 2) // Agreed amount
  totalCartons       Int        @default(0)
  totalCBM           Decimal    @default(0) @db.Decimal(10, 3)
  invoiceNumber      String?    @unique
  invoiceUrl         String? // PDF invoice URL
  barcode            String?    @unique
  qrCodeUrl          String? // QR code for deal
  notes              String?    @db.Text
  approvedAt         DateTime?
  paidAt             DateTime?
  settledAt          DateTime?
  cancelledAt        DateTime?
  cancellationReason String?    @db.Text
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  // Relations
  offer         Offer               @relation(fields: [offerId], references: [id])
  trader        Trader              @relation(fields: [traderId], references: [id])
  client        Client              @relation(fields: [clientId], references: [id])
  employee      Employee            @relation(fields: [employeeId], references: [id])
  items         DealItem[]
  negotiations  DealNegotiation[]
  payments      Payment[]
  invoices      Invoice[]
  statusHistory DealStatusHistory[]
  activityLogs  ActivityLog[]       @relation("ActivityLogDeal")
  auditTrails   AuditTrail[]        @relation("AuditTrailDeal")

  @@index([offerId])
  @@index([traderId])
  @@index([clientId])
  @@index([employeeId])
  @@index([status])
  @@index([dealNumber])
}

model DealItem {
  id              Int      @id @default(autoincrement())
  dealId          Int
  offerItemId     Int
  quantity        Int // Negotiated quantity
  cartons         Int
  cbm             Decimal  @db.Decimal(10, 3)
  negotiatedPrice Decimal? @db.Decimal(10, 2) // Per unit if applicable
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  deal      Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  offerItem OfferItem @relation(fields: [offerItemId], references: [id])

  @@index([dealId])
  @@index([offerItemId])
}

model DealStatusHistory {
  id            Int        @id @default(autoincrement())
  dealId        Int
  status        DealStatus
  description   String?    @db.Text
  changedBy     Int? // User ID who changed
  changedByType UserType
  createdAt     DateTime   @default(now())

  // Relations
  deal Deal @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([dealId])
}

// ============================================
// NEGOTIATION SYSTEM
// ============================================

model DealNegotiation {
  id               Int                    @id @default(autoincrement())
  dealId           Int
  traderId         Int
  clientId         Int
  messageType      NegotiationMessageType @default(TEXT)
  message          String                 @db.Text
  proposedPrice    Decimal?               @db.Decimal(10, 2)
  proposedQuantity Int?
  isRead           Boolean                @default(false)
  readAt           DateTime?
  createdAt        DateTime               @default(now())

  // Relations
  deal   Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  trader Trader @relation("DealNegotiationTrader", fields: [traderId], references: [id])
  client Client @relation("DealNegotiationClient", fields: [clientId], references: [id])

  @@index([dealId])
  @@index([traderId])
  @@index([clientId])
  @@index([createdAt])
}

// ============================================
// FINANCIAL INTERMEDIARY SYSTEM
// ============================================

model Payment {
  id            Int           @id @default(autoincrement())
  dealId        Int
  clientId      Int
  amount        Decimal       @db.Decimal(10, 2)
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String?       @unique
  receiptUrl    String? // Payment receipt
  verifiedAt    DateTime?
  verifiedBy    Int? // Employee ID
  notes         String?       @db.Text
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  deal                 Deal                  @relation(fields: [dealId], references: [id])
  client               Client                @relation(fields: [clientId], references: [id])
  financialTransaction FinancialTransaction?

  @@index([dealId])
  @@index([clientId])
  @@index([status])
  @@index([transactionId])
}

model FinancialTransaction {
  id          Int               @id @default(autoincrement())
  dealId      Int?
  paymentId   Int?              @unique
  type        TransactionType
  amount      Decimal           @db.Decimal(10, 2)
  status      TransactionStatus @default(PENDING)
  description String?           @db.Text

  // Commission breakdown
  platformCommission Decimal? @db.Decimal(10, 2)
  employeeCommission Decimal? @db.Decimal(10, 2)
  traderAmount       Decimal? @db.Decimal(10, 2)
  
  // CBM-based commission (new field)
  totalCBM           Decimal? @db.Decimal(10, 3) // Total CBM for this deal
  cbmBasedCommission Decimal? @db.Decimal(10, 2) // Commission calculated based on CBM
  cbmRate            Decimal? @db.Decimal(10, 2) // CBM rate used for calculation
  commissionMethod   String? // PERCENTAGE, CBM, BOTH - method used

  // Related entities
  employeeId  Int?
  traderId    Int?
  processedBy Int? // Admin/Employee ID
  processedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  payment  Payment?  @relation(fields: [paymentId], references: [id])
  employee Employee? @relation("FinancialTransactionEmployee", fields: [employeeId], references: [id])
  admin    Admin?    @relation("FinancialTransactionAdmin", fields: [processedBy], references: [id])

  @@index([dealId])
  @@index([paymentId])
  @@index([type])
  @@index([status])
}

model FinancialLedger {
  id            Int      @id @default(autoincrement())
  transactionId Int // FinancialTransaction ID
  entryType     String // DEBIT or CREDIT
  accountType   String // PLATFORM, EMPLOYEE, TRADER, CLIENT
  accountId     Int? // ID of the account holder
  amount        Decimal  @db.Decimal(10, 2)
  balanceBefore Decimal  @db.Decimal(10, 2)
  balanceAfter  Decimal  @db.Decimal(10, 2)
  description   String?  @db.Text
  reference     String? // Deal number, invoice number, etc.
  createdAt     DateTime @default(now())

  @@index([transactionId])
  @@index([accountType, accountId])
  @@index([createdAt])
}

model Invoice {
  id                 Int           @id @default(autoincrement())
  dealId             Int
  invoiceNumber      String        @unique
  invoiceUrl         String // PDF URL
  status             InvoiceStatus @default(DRAFT)
  subtotal           Decimal       @db.Decimal(10, 2)
  platformCommission Decimal       @db.Decimal(10, 2)
  employeeCommission Decimal       @db.Decimal(10, 2)
  traderAmount       Decimal       @db.Decimal(10, 2)
  total              Decimal       @db.Decimal(10, 2)
  tax                Decimal?      @db.Decimal(10, 2)
  issuedAt           DateTime?
  paidAt             DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt

  // Relations
  deal Deal @relation(fields: [dealId], references: [id])

  @@index([dealId])
  @@index([invoiceNumber])
  @@index([status])
}

// ============================================
// AUDIT & ACTIVITY LOGGING
// ============================================

model ActivityLog {
  id          Int      @id @default(autoincrement())
  userId      Int?
  userType    UserType
  action      String
  entityType  String? // DEAL, OFFER, NEGOTIATION, PAYMENT, etc.
  entityId    Int?
  description String?  @db.Text
  changes     String?  @db.Text // JSON
  ipAddress   String?
  userAgent   String?
  location    String?
  metadata    String?  @db.Text // JSON
  createdAt   DateTime @default(now())

  // Relations - Polymorphic
  admin    Admin?    @relation("ActivityLogAdmin", fields: [userId], references: [id], map: "ActivityLog_Admin_fkey")
  employee Employee? @relation("ActivityLogEmployee", fields: [userId], references: [id], map: "ActivityLog_Employee_fkey")
  trader   Trader?   @relation("ActivityLogTrader", fields: [userId], references: [id], map: "ActivityLog_Trader_fkey")
  client   Client?   @relation("ActivityLogClient", fields: [userId], references: [id], map: "ActivityLog_Client_fkey")
  deal     Deal?     @relation("ActivityLogDeal", fields: [entityId], references: [id], map: "ActivityLog_Deal_fkey")
  offer    Offer?    @relation("ActivityLogOffer", fields: [entityId], references: [id], map: "ActivityLog_Offer_fkey")

  @@index([userId, userType])
  @@index([entityType, entityId])
  @@index([createdAt])
}

model AuditTrail {
  id           Int         @id @default(autoincrement())
  userId       Int?
  userType     UserType
  action       AuditAction
  entityType   String?
  entityId     Int?
  oldValue     String?     @db.Text // JSON
  newValue     String?     @db.Text // JSON
  reason       String?     @db.Text
  ipAddress    String?
  userAgent    String?
  success      Boolean     @default(true)
  errorMessage String?     @db.Text
  createdAt    DateTime    @default(now())

  // Relations - Polymorphic
  admin    Admin?    @relation("AuditTrailAdmin", fields: [userId], references: [id], map: "AuditTrail_Admin_fkey")
  employee Employee? @relation("AuditTrailEmployee", fields: [userId], references: [id], map: "AuditTrail_Employee_fkey")
  trader   Trader?   @relation("AuditTrailTrader", fields: [userId], references: [id], map: "AuditTrail_Trader_fkey")
  client   Client?   @relation("AuditTrailClient", fields: [userId], references: [id], map: "AuditTrail_Client_fkey")
  deal     Deal?     @relation("AuditTrailDeal", fields: [entityId], references: [id], map: "AuditTrail_Deal_fkey")

  @@index([userId, userType])
  @@index([entityType, entityId])
  @@index([action])
  @@index([createdAt])
}

// ============================================
// NOTIFICATION SYSTEM
// ============================================

model Notification {
  id                Int       @id @default(autoincrement())
  userId            Int
  userType          UserType
  type              String // DEAL, NEGOTIATION, PAYMENT, etc.
  title             String
  message           String    @db.Text
  relatedEntityType String?
  relatedEntityId   Int?
  isRead            Boolean   @default(false)
  readAt            DateTime?
  createdAt         DateTime  @default(now())

  @@index([userId, userType])
  @@index([isRead])
  @@index([createdAt])
}

// ============================================
// CONTENT MANAGEMENT
// ============================================

model ContentPage {
  id              Int             @id @default(autoincrement())
  type            ContentPageType
  title           String
  slug            String          @unique // URL-friendly identifier
  content         String          @db.Text // HTML or Markdown content
  excerpt         String?         @db.Text // Short description/summary
  metaTitle       String? // SEO meta title
  metaDescription String?         @db.Text // SEO meta description
  metaKeywords    String?         @db.Text // SEO keywords
  isActive        Boolean         @default(true)
  isPublished     Boolean         @default(false)
  publishedAt     DateTime?
  language        String          @default("ar") // ar, en, etc.
  order           Int             @default(0) // Display order
  views           Int             @default(0) // View count
  // Contact Us specific fields
  email           String? // Contact email
  phone           String? // Contact phone
  address         String?         @db.Text // Contact address
  workingHours    String?         @db.Text // Working hours
  socialMedia     String?         @db.Text // JSON: {facebook, twitter, instagram, etc.}
  // Support Center specific fields
  category        String? // Support category
  priority        String? // HIGH, MEDIUM, LOW
  // Relations
  createdBy       Int? // Admin/Employee ID
  updatedBy       Int? // Admin/Employee ID
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  creator Admin? @relation("ContentPageCreator", fields: [createdBy], references: [id])
  updater Admin? @relation("ContentPageUpdater", fields: [updatedBy], references: [id])

  @@index([type])
  @@index([slug])
  @@index([isActive])
  @@index([isPublished])
  @@index([language])
  @@index([createdAt])
}

// ============================================
// CATEGORY MANAGEMENT
// ============================================

model Category {
  id              Int       @id @default(autoincrement())
  nameKey         String    @unique // Translation key
  descriptionKey  String?   @db.Text
  slug            String    @unique
  parentId        Int?
  isActive        Boolean   @default(true)
  isFeatured      Boolean   @default(false)
  displayOrder    Int       @default(0)
  icon            String?
  imageUrl        String?
  level           Int       @default(0)
  productCount    Int       @default(0)
  breadcrumb      String?
  metaTitleKey    String?
  metaDescriptionKey String? @db.Text
  metaKeywords    String?   @db.Text
  canonicalUrl    String?
  ogTitleKey      String?
  ogDescriptionKey String?   @db.Text
  ogImage         String?
  twitterCardTitleKey String?
  twitterCardDescriptionKey String? @db.Text
  twitterCardImage String?
  structuredData  String?   @db.Text
  pageDescriptionKey String? @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  parent          Category? @relation("CategoryTree", fields: [parentId], references: [id])
  children        Category[] @relation("CategoryTree")
  offers          Offer[]   @relation("OfferCategory") // Offers in this category

  @@index([parentId])
  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@index([displayOrder])
}

// ============================================
// PLATFORM SETTINGS
// ============================================

model PlatformSettings {
  id                    Int       @id @default(autoincrement())
  // Commission Settings
  platformCommissionRate Decimal? @db.Decimal(5, 2) // Percentage based on deal amount (default: 2.5%)
  cbmRate                Decimal? @db.Decimal(10, 2) // Rate per cubic meter (CBM) for deals (e.g., 50 SAR per CBM)
  // Financial Settings
  taxRate                Decimal? @db.Decimal(5, 2) // Tax rate percentage
  currency               String?  @default("SAR")
  // General Settings
  platformName           String?  @default("Stockship")
  platformEmail          String?
  platformPhone          String?
  platformAddress        String?  @db.Text
  defaultLanguage        String?  @default("ar")
  timezone               String?  @default("Asia/Riyadh")
  // Commission Calculation Method
  // 'PERCENTAGE': Use platformCommissionRate based on deal amount
  // 'CBM': Use cbmRate based on total CBM in deal
  // 'BOTH': Use both methods and take the higher value
  commissionMethod       String?  @default("PERCENTAGE") // PERCENTAGE, CBM, BOTH
  // Last Updated
  updatedBy              Int? // Admin ID who last updated
  updatedAt              DateTime @updatedAt
  createdAt              DateTime @default(now())

  // Relations
  updater Admin? @relation("PlatformSettingsUpdater", fields: [updatedBy], references: [id])

  @@index([updatedBy])
}
