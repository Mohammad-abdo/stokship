# ุงูููุงู ุงููุฌุฏููุฉ - ุฏููู ุงูุงุณุชุฎุฏุงู ุจุงูุนุฑุจูุฉ

## ูุธุงู ุฅูุบุงุก ุงูุทูุจุงุช ุบูุฑ ุงููุฏููุนุฉ โฐ

ุชู ุฅูุดุงุก ูุธุงู ุชููุงุฆู ูููู ุจุฅูุบุงุก ุงูุทูุจุงุช ุบูุฑ ุงููุฏููุนุฉ ุจุนุฏ 72 ุณุงุนุฉ ูู ุฅูุดุงุฆูุง.

## โจ ููู ูุนููุ

ุงููุธุงู ููุญุต ุงูุทูุจุงุช ูู ุณุงุนุฉ ููุจุญุซ ุนู:
1. ุงูุทูุจุงุช ุงูุชู ูุฑ ุนูููุง ุฃูุซุฑ ูู 72 ุณุงุนุฉ
2. ูู ูุชู ุฏูุนูุง (ูุง ููุฌุฏ ุฏูุนุฉ ุจุญุงูุฉ "ููุชููุฉ")
3. ุญุงูุชูุง ููุณุช "ููุบูุฉ" ุฃู "ููุชููุฉ"

ุซู ูููู ุชููุงุฆูุงู ุจู:
- โ ุชุญููู ุญุงูุฉ ุงูุทูุจ ุฅูู "ููุบู"
- โ ุชุณุฌูู ุณุจุจ ุงูุฅูุบุงุก
- โ ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
- โ ุฅูุดุงุก ุณุฌู ุชุชุจุน ููุทูุจ

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุงูุชุดุบูู ุงูุชููุงุฆู

ุจุจุณุงุทุฉ ุดุบูู ุงูุฎุงุฏู ูุณูุนูู ุงููุธุงู ุชููุงุฆูุงู:

```bash
npm start
```

ุฃู ูู ุจูุฆุฉ ุงูุชุทููุฑ:

```bash
npm run dev
```

### 2. ุงูุงุฎุชุจุงุฑ ุงููุฏูู

ูุจู ุงูุชูุนูู ูู ุงูุฅูุชุงุฌุ ููููู ุงุฎุชุจุงุฑ ุงููุธุงู:

```bash
# ุนุฑุถ ุงูุทูุจุงุช ุงูุชู ุณูุชู ุฅูุบุงุคูุง (ุจุฏูู ุชูููุฐ)
npm run job:cancel-unpaid

# ุชูููุฐ ุงูุฅูุบุงุก ูุนููุงู
npm run job:cancel-unpaid:confirm
```

## โ๏ธ ุงูุชุฎุตูุต

### ุชุบููุฑ ุงููุฏุฉ ุงูุฒูููุฉ

ุฃุถู ุฅูู ููู `.env`:

```env
# ุฅูุบุงุก ุจุนุฏ 24 ุณุงุนุฉ ุจุฏูุงู ูู 72
UNPAID_ORDER_CANCEL_HOURS=24
```

### ุชุบููุฑ ุฌุฏูู ุงูุชุดุบูู

```env
# ุงูุชุดุบูู ูู 6 ุณุงุนุงุช ุจุฏูุงู ูู ูู ุณุงุนุฉ
UNPAID_ORDER_CRON_SCHEDULE=0 */6 * * *
```

### ุชุนุทูู ุงููุธุงู ูุคูุชุงู

```env
# ุฅููุงู ุงููุธุงู
UNPAID_ORDER_CANCEL_ENABLED=false
```

### ุชุนุทูู ุงูุฅุดุนุงุฑุงุช

```env
# ุฅููุงู ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏููู
UNPAID_ORDER_SEND_NOTIFICATIONS=false
```

### ุชุฎุตูุต ุฑุณุงูุฉ ุงูุฅูุบุงุก

```env
# ุฑุณุงูุฉ ูุฎุตุตุฉ (ุงุณุชุฎุฏู {hours} ูุนุฏุฏ ุงูุณุงุนุงุช)
UNPAID_ORDER_CANCEL_MESSAGE=ุทูุจู ุชู ุฅูุบุงุคู ุชููุงุฆูุงู ุจุนุฏ {hours} ุณุงุนุฉ ูู ุนุฏู ุงูุฏูุน
```

## ๐ ูุฑุงูุจุฉ ุงููุธุงู

### ุงูุณุฌูุงุช (Logs)

ุนูุฏ ุชุดุบูู ุงูุฎุงุฏู ุณุชุดุงูุฏ:

```
โ ุชู ุชูุนูู job ุฅูุบุงุก ุงูุทูุจุงุช ุบูุฑ ุงููุฏููุนุฉ - ุงูุฌุฏูู: 0 * * * * - ุงููุฏุฉ: 72 ุณุงุนุฉ
```

ูุนูุฏ ุนูู ุงููููุฉ:

```
โ ุจุฏุก ูุญุต ุงูุทูุจุงุช ุบูุฑ ุงููุฏููุนุฉ (ุงููุฏุฉ: 72 ุณุงุนุฉ)...
โ ุชู ุงูุนุซูุฑ ุนูู 3 ุทูุจุงุช ุบูุฑ ูุฏููุนุฉ
โ ุชู ุฅูุบุงุก ุงูุทูุจ SHR123456789 (ID: 45)
โ ุชู ุฅูุบุงุก ุงูุทูุจ SHR987654321 (ID: 46)
โ ุชู ุฅูุบุงุก ุงูุทูุจ SHR555444333 (ID: 47)
โ ุงูุชูู ูุญุต ุงูุทูุจุงุช. ุชู ุฅูุบุงุก 3 ุทูุจุงุช
```

## ๐ ุฃูุซูุฉ ุฌุฏุงูู ุงูุชุดุบูู

```env
# ูู ุณุงุนุฉ (ุงูุงูุชุฑุงุถู)
UNPAID_ORDER_CRON_SCHEDULE=0 * * * *

# ูู 6 ุณุงุนุงุช
UNPAID_ORDER_CRON_SCHEDULE=0 */6 * * *

# ูู ููู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
UNPAID_ORDER_CRON_SCHEDULE=0 2 * * *

# ูู 30 ุฏูููุฉ
UNPAID_ORDER_CRON_SCHEDULE=*/30 * * * *

# ูู ููู ุฃุญุฏ ูู ููุชุตู ุงูููู
UNPAID_ORDER_CRON_SCHEDULE=0 0 * * 0
```

## ๐ฏ ุงูุญุงูุงุช ุงูุชู ูุชู ุฅูุบุงุคูุง

ุณูุชู ุฅูุบุงุก ุงูุทูุจ ุฅุฐุง:
- โ ูุฑ ุนููู ุฃูุซุฑ ูู 72 ุณุงุนุฉ (ุฃู ุงููุฏุฉ ุงููุญุฏุฏุฉ)
- โ ูู ูุชู ุฏูุนู (ูุง ุชูุฌุฏ ุฏูุนุฉ ุจุญุงูุฉ COMPLETED)
- โ ุญุงูุชู ููุณุช: CANCELLED ุฃู COMPLETED ุฃู PAYMENT_CONFIRMED

ูู ูุชู ุฅูุบุงุก ุงูุทูุจ ุฅุฐุง:
- โ ุชู ุฏูุนู (ููุฌุฏ ุฏูุนุฉ ุจุญุงูุฉ COMPLETED)
- โ ุญุงูุชู CANCELLED (ููุบู ูุณุจูุงู)
- โ ุญุงูุชู COMPLETED (ููุชูู)
- โ ุญุงูุชู PAYMENT_CONFIRMED (ุชู ุชุฃููุฏ ุงูุฏูุน)

## โ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### ูู ูููู ุชุบููุฑ ุงููุฏุฉ ูุทูุจุงุช ูุนููุฉุ

ุญุงููุงูุ ุงููุฏุฉ ููุญุฏุฉ ูุฌููุน ุงูุทูุจุงุช. ุฅุฐุง ููุช ุชุฑูุฏ ูุฏุฏ ูุฎุชููุฉ ุญุณุจ ููุน ุงูุทูุจุ ูููู ุชุนุฏูู ุงูููุฏ.

### ูู ุงููุธุงู ุขููุ

ูุนูุ ุงููุธุงู ูู ููุบู:
- ุงูุทูุจุงุช ุงููุฏููุนุฉ
- ุงูุทูุจุงุช ุงูููุชููุฉ
- ุงูุทูุจุงุช ุงูููุบุงุฉ ูุณุจูุงู

### ูุงุฐุง ูุญุฏุซ ุฅุฐุง ุฏูุน ุงููุณุชุฎุฏู ูู ุงููุญุธุฉ ุงูุฃุฎูุฑุฉุ

ุงููุธุงู ูุชุญูู ูู ุญุงูุฉ ุงูุฏูุน ูุจู ุงูุฅูุบุงุก. ุฅุฐุง ุชู ุงูุฏูุน ูุจู ุชุดุบูู ุงููููุฉุ ูู ูุชู ุงูุฅูุบุงุก.

### ูู ูููู ุงุณุชุฑุฌุงุน ุงูุทูุจุงุช ุงูููุบุงุฉุ

ูููู ุงุณุชุฑุฌุงุนูุง ูุฏููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ููู ูููุตุญ ุจุฅูุดุงุก ุทูุจ ุฌุฏูุฏ.

### ููู ุฃุนุฑู ุฅุฐุง ูุงู ุงููุธุงู ูุนููุ

ุฑุงุฌุน ุงูุณุฌูุงุช (logs) - ุณุชุฑู ุฑุณุงุฆู ูู ุณุงุนุฉ ุชูุถุญ ูุชุงุฆุฌ ุงููุญุต.

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุธุงู ูุง ูุนูู

1. ุชุญูู ูู ุฃู `UNPAID_ORDER_CANCEL_ENABLED` ููุณ `false`
2. ุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุจุนุฏ ุชุบููุฑ `.env`
3. ุฑุงุฌุน ุงูุณุฌูุงุช ููุจุญุซ ุนู ุฃุฎุทุงุก

### ูุง ูุชู ุฅูุบุงุก ุทูุจุงุช ูุนููุฉ

1. ุชุญูู ูู ุชุงุฑูุฎ ุฅูุดุงุก ุงูุทูุจ
2. ุชุฃูุฏ ูู ุญุงูุฉ ุงูุทูุจ
3. ุชุญูู ูู ูุฌูุฏ ุฏูุนุงุช ููุทูุจ

### ุงูุฌุฏูู ูุง ูุนูู ููุง ูู ูุชููุน

ุชุฃูุฏ ูู ุตูุบุฉ Cron ุตุญูุญุฉ. ุงุณุชุฎุฏู [crontab.guru](https://crontab.guru) ููุชุญูู.

## ๐ ูููุงุช ูููุฏุฉ

- `cancelUnpaidOrders.js` - ุงูููุฏ ุงูุฑุฆูุณู
- `config.js` - ุงูุฅุนุฏุงุฏุงุช
- `testCancelUnpaid.js` - ุฃุฏุงุฉ ุงูุงุฎุชุจุงุฑ
- `ENV_VARIABLES.md` - ุดุฑุญ ููุตู ูููุชุบูุฑุงุช

## ๐ก ูุตุงุฆุญ

1. **ุงุจุฏุฃ ุจูุฏุฉ ูุตูุฑุฉ ูู ุงูุชุทููุฑ** (ูุซูุงู 1 ุณุงุนุฉ) ููุงุฎุชุจุงุฑ
2. **ุฑุงูุจ ุงูุณุฌูุงุช ุจุงูุชุธุงู** ุฎุตูุตุงู ูู ุงูุจุฏุงูุฉ
3. **ุงุฎุชุจุฑ ูู ุจูุฆุฉ ุงูุชุทููุฑ** ูุจู ุงูุฅูุชุงุฌ
4. **ุงุถุจุท ุงูุฌุฏูู ุญุณุจ ุงุญุชูุงุฌู** - ูุง ุญุงุฌุฉ ููู ุณุงุนุฉ ุฅุฐุง ูุงู ูู 6 ุณุงุนุงุช ูุงูู

## โ ูุงุฆูุฉ ุงูุชุญูู ููุฅูุชุงุฌ

- [ ] ุชู ุงูุงุฎุชุจุงุฑ ูู ุจูุฆุฉ ุงูุชุทููุฑ
- [ ] ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูุถุจูุทุฉ ุจุดูู ุตุญูุญ
- [ ] ุงูุณุฌูุงุช ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุชู ุงูุชุญูู ูู ุนูู ุงูุฅุดุนุงุฑุงุช
- [ ] ุชู ุงูุชุฃูุฏ ูู ุตุญุฉ ุฌุฏูู ุงูุชุดุบูู
- [ ] ุชู ุฅุจูุงุบ ุงููุฑูู ุจุงููุธุงู ุงูุฌุฏูุฏ

---

๐ **ูุจุฑูู! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู**

ูููุฒูุฏ ูู ุงูุชูุงุตููุ ุฑุงุฌุน:
- [../CANCEL_UNPAID_ORDERS.md](../../CANCEL_UNPAID_ORDERS.md)
- [ENV_VARIABLES.md](./ENV_VARIABLES.md)
